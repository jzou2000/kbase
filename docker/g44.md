---
title: Make Toolchains with Docker
date: 2019-03-19
nav: make toolchains with docker
tags: [docker, cheatsheet, develop, toolchain, gcc44]
---

## install g++-4.4 on centos6

```bash
# centos6 g++ is 4.4.7, 64-bit only
yum -y install gcc-c++ libstdc++-devel glibc-devel

# 32bit support on 64bit system
yum -y install glibc-devel.i686 libstdc++-devel.i686
# centos5
#  yum -y install glibc-devel.i386 libstdc++-devel.i386
# debian
#  apt-get install g++-multilib libc6-dev-i386

# m4 is required for lots of autoconfig packages
yum -y install m4
```


Dockerfile used to build the image
```bash
FROM centos:6

RUN yum -y install gcc-c++ glibc-devel libstdc++-devel glibc-devl.i686 libstdc++-devel.i686 m4

```

```bash
cd ~/docker/d-cen6g44 # working folder to run docker build
ls
Dockerfile
docker build --tag=cen6g44 .
docker images ls
REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE
cen6g44                            latest              f74030d0927a        5 seconds ago       327MB
centos                             6                   d0957ffdf8a2        5 days ago          194MB

```

```cpp
// bit.cpp
#include <iostream>

using namespace std;

int main()
{
    int a;
    cout << "sizeof(int)=" << sizeof(int)
         << " sizeof(long)=" << sizeof(long)
         << " sizeof(long long)=" << sizeof(long long)
         << " sizeof(void*)=" << sizeof(void*)
         << endl;
    return 0;
}
```

```bash
g++ -o b bit.cpp
g++ -o b32 -m32 bit.cpp
```


## install python2.7 on centos6

Default python on CentOS6 is 2.6.6.

```bash
# some devel modules (mostly heads) are required to build python from source
# about 77MB are added after installation.
# note: tk(tk-devel), imageop(?), sunaudiodev(?) are not wildly required
yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel gdbm-devel libpcap-devel xz-devel expat-devel

# go to the working folder $WKS
cd $WKS
curl https://www.python.org/ftp/python/2.7.16/Python-2.7.16.tgz -o Python-2.7.16.tgz

# use wget if curl is not available
tar xzf Python-2.7.16.tgz
cd Python-2.7.16
./configure --enable-optimizations

# use altinstall to prevent replacing the default python
# the install size will be about 117MB
make altinstall
cd ..
rm -rf Python-2.7.16*

# check version installed
/usr/local/bin/python2.7 --version

# pip
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python2.7 get-pip.py

# ....
# add 194MB in total

Python build finished, but the necessary bits to build these modules were not found:
_bsddb             _curses            _curses_panel   
_sqlite3           _ssl               _tkinter        
bsddb185           bz2                dbm             
dl                 gdbm               imageop         
readline           sunaudiodev        zlib            

```

To find the necessary bits, look in setup.py in detect_modules() for the module's name.

```bash
# Start by making sure your system is up-to-date:
# sudo yum update
# sudo yum install yum-utils
# sudo yum groupinstall development
# Libraries needed during compilation to enable all features of Python:
# yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel expat-devel
yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel gdbm-devel libpcap-devel xz-devel expat-devel


# (77mb for xxx-devel)

# pip to manage Python packages,and some development packages.
sudo yum install python36u-pip
sudo yum install python36u-devel
```

After update, run make again:
```bash
#...
Python build finished, but the necessary bits to build these modules were not found:
_bsddb             _tkinter           bsddb185        
dl                 imageop            sunaudiodev     
To find the necessary bits, look in setup.py in detect_modules() for the module's name.
```



### Get pip
```bash
curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
python2.7 get-pip.py
```


## Install Perl

Perl is not contained by default on centos6 docker. Several utilities requires perl.

```bash
yum -y install perl
```


## The FAT agent

The FAT version contains python 2.7 and perl 5.10

```bash
ROM cen6g44

RUN yum -y install perl zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel gdbm-devel libpcap-devel xz-devel expat-devel \
 && curl https://www.python.org/ftp/python/2.7.16/Python-2.7.16.tgz -o Python-2.7.16.tgz \
 && tar xzf Python-2.7.16.tgz \
 && cd Python-2.7.16 \
 && ./configure --enable-optimizations \
 && make altinstall \
 && cd .. \
 && rm -rf Python-2.7.16* \
 && yum -y remove zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel gdbm-devel libpcap-devel xz-devel expat-devel
```

To build it
```bash
docker build -t agent44 .
```

The size of the two versions are
```bash
jzou@debian9:~/docker/agent44$ docker images
REPOSITORY               TAG                 IMAGE ID            CREATED              SIZE
agent44                  latest              46985c8a286a        About a minute ago   533MB
cen6g44                  latest              31e4edf89146        3 months ago         327MB
```


